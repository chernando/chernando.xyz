---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const posts = await getCollection('posts-es');

// Get all tags from published posts with counts
const tagCounts = new Map<string, number>();

posts
  .filter(post => !post.data.draft)
  .forEach(post => {
    post.data.tags.forEach(tag => {
      tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
    });
  });

// Sort tags alphabetically
const sortedTags = Array.from(tagCounts.entries())
  .sort(([a], [b]) => a.localeCompare(b));

const pageTitle = 'Etiquetas | Carlos Hernando';
const pageDescription = 'Explora todos los temas y etiquetas de mis artículos sobre desarrollo web, programación y tecnología.';
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  type="website"
  lang="es"
>
  <section aria-label="Explorar todas las etiquetas">
    <header>
      <h2>Todas las Etiquetas</h2>
      <p>
        Explora artículos por tema. Se encontraron {sortedTags.length} etiqueta{sortedTags.length === 1 ? '' : 's'}
        en {posts.filter(post => !post.data.draft).length} artículos publicados.
      </p>
    </header>

    {sortedTags.length === 0 ? (
      <p>No se encontraron etiquetas aún.</p>
    ) : (
      <ul>
        {sortedTags.map(([tag, count]) => (
          <li>
            <a href={`/etiquetas/${tag}/`} rel="tag">
              <strong>#{tag}</strong>
              <span>({count} artículo{count === 1 ? '' : 's'})</span>
            </a>
          </li>
        ))}
      </ul>
    )}

    <nav aria-label="Navegar atrás">
      <p>
        <a href="/articulos/">← Volver a todos los artículos</a>
      </p>
    </nav>
  </section>
</BaseLayout>